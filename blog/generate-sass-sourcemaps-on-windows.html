<!DOCTYPE html>
<html>
    <head>
        <meta http-equiv="content-type" content="text/html; charset=utf-8" />
        <title>Generate SASS sourcemaps on Windows</title>
        <link rel="stylesheet" href="../css/normalize.css" type="text/css" media="all">
        <link rel="stylesheet" href="../css/style.css" type="text/css" media="all">
<meta name="updated" content="February 5, 2014" /><meta name="description" content="Troubleshooting some common problems with generating sourcemaps with scss on Windows" /><meta name="author" content="Mihai Rotaru" /><meta name="tags" content="CSS,SASS,SCSS,sourcemaps,DevTools,Vim" /><meta name="date" content="February 4, 2014" /><meta name="title" content="Generate SASS sourcemaps on Windows" />
        <script>
            (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
             (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
             m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
             })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

            ga('create', 'UA-47687575-1', 'rw.cm');
            ga('send', 'pageview');
        </script>
    </head>
    <body>
    <h5>Posted: February 4, 2014 Updated: February 5, 2014</h5>
<h1>Generate <abbr title="Syntactically Awesome Stylesheets">SASS</abbr> sourcemaps on Windows</h1>
<p>You might be aware of the awesomeness that is possible with upcoming Sass 3.3
and Chrome DevTools. It allows you to treat <abbr title="Syntactically Awesome Stylesheets">SCSS</abbr> as <abbr title="Cascading Style Sheets">CSS</abbr> - with inline editing,
and all that. Check <a href="https://www.youtube.com/watch?v=x6qe_kVaBpg">this</a> out, if
you're not. It's a video from the 2013 Google IO conference, with Paul Irish
showing you what can be achieved.</p>
<h4>Why would I need sourcemaps ?</h4>
<p>The biggest problem with <abbr title="Syntactically Awesome Stylesheets">SCSS</abbr> and other pre-processors is that you write in one
language (<abbr title="Syntactically Awesome Stylesheets">SCSS</abbr>), but in you DevTools/Firebug, you get <abbr title="Cascading Style Sheets">CSS</abbr>. This indirection can
make it difficult to "map" the generated <abbr title="Cascading Style Sheets">CSS</abbr> to the <abbr title="Syntactically Awesome Stylesheets">SCSS</abbr> you've written.</p>
<p>For example, you can see that a button is red. You fire up DevTools to see
where that color is set. You quickly spot the <abbr title="Cascading Style Sheets">CSS</abbr> rule, but then you realize
that the <abbr title="Cascading Style Sheets">CSS</abbr> you're looking at was actually generated by <code>sass</code> from your <abbr title="Syntactically Awesome Stylesheets">SCSS</abbr>
file! And you have to manually look through the <abbr title="Syntactically Awesome Stylesheets">SCSS</abbr> code, trying to find which
<abbr title="Syntactically Awesome Stylesheets">SCSS</abbr> rule generated the <abbr title="Cascading Style Sheets">CSS</abbr> rule.</p>
<p>In simple cases, this "mapping" might not be an issue. However, in projects of
any significance, this can be frustrating.</p>
<p>This is the problem sourcemaps are meant to solve. Basically, you tell <code>sass</code>
that when it generates <abbr title="Cascading Style Sheets">CSS</abbr> files from your <abbr title="Syntactically Awesome Stylesheets">SCSS</abbr> code, it should also create a
file that explicitly states which <abbr title="Syntactically Awesome Stylesheets">SCSS</abbr> code generated each <abbr title="Cascading Style Sheets">CSS</abbr> statement.</p>
<p>So, if you have style.scss, after running <code>sass</code> you get the usual style.css, and
style.map. This .map file is not meant for human consumption, but Chrome
DevTools knows how to read it, and enables it to tell exactly where each <abbr title="Cascading Style Sheets">CSS</abbr>
statement comes from. Effectively, it maps the contents of the generated <abbr title="Cascading Style Sheets">CSS</abbr>
file back to the "source" <abbr title="Syntactically Awesome Stylesheets">SCSS</abbr> code. Hence, sourcemap!</p>
<h4>Getting <code>sass</code> to work on Windows</h4>
<p>Setup for unixy platforms is easy, described
<a href="https://medium.com/what-i-learned-building/b4daab987fb0">here</a> among other
places. But I ran into a few issues on Windows.</p>
<p>First of all, since this functionality is not yet included in stable <code>sass</code> gems,
you need to get a <code>--pre</code> version of the gem. But it didn't work for me:</p>
<pre><code>$ gem install sass --pre --no-ri --no-rdoc
ERROR:  While executing gem ... (Gem::DependencyError)
  Unable to resolve dependencies: sass requires listen (~&gt; 1.1.0)
</code></pre>
<p>After some research I did find something that worked:</p>
<pre><code>$ gem install sass -v 3.3.0.rc.2
</code></pre>
<p>Dependencies are installed, no errors shown; seems like it worked ! To make sure:</p>
<pre><code>$ scss --version
Sass 3.3.0.rc.2 (Maptastic Maple)
</code></pre>
<p>Awesome ! But then I ran into another problem:</p>
<pre><code>C:\Windows\system32\cmd.exe /c (scss --sourcemap --trace C:\code\scss\style.scss C:\code\css\style.css)
C:/Ruby200-x64/lib/ruby/2.0.0/pathname.rb:500:in `relative_path_from': different
 prefix: "C:/" and "C:\\code/tc/mockup/css" (ArgumentError)
        from C:/Ruby200-x64/lib/ruby/gems/2.0.0/gems/sass-3.3.0.rc.2/lib/sass/source/map.rb:128:in `block in to_json'
        from C:/Ruby200-x64/lib/ruby/gems/2.0.0/gems/sass-3.3.0.rc.2/lib/sass/source/map.rb:123:in `each'
        from C:/Ruby200-x64/lib/ruby/gems/2.0.0/gems/sass-3.3.0.rc.2/lib/sass/source/map.rb:123:in `to_json'
        from C:/Ruby200-x64/lib/ruby/gems/2.0.0/gems/sass-3.3.0.rc.2/lib/sass/exec.rb:378:in `process_result'
        from C:/Ruby200-x64/lib/ruby/gems/2.0.0/gems/sass-3.3.0.rc.2/lib/sass/exec.rb:43:in `parse'
        from C:/Ruby200-x64/lib/ruby/gems/2.0.0/gems/sass-3.3.0.rc.2/lib/sass/exec.rb:22:in `parse!'
        from C:/Ruby200-x64/lib/ruby/gems/2.0.0/gems/sass-3.3.0.rc.2/bin/scss:9:in `&lt;top (required)&gt;'
        from C:/Ruby200-x64/bin/scss:23:in `load'
        from C:/Ruby200-x64/bin/scss:23:in `&lt;main&gt;'
shell returned 1
Hit any key to close this window...
</code></pre>
<p>This problem is described in a couple of places, the best description I could
find being <a href="https://github.com/oneclick/rubyinstaller/issues/179">on this RubyInstaller
issue</a>. The issue is that
Ruby's Pathname wants files as <code>C:/code/source.scss</code>; it cannot accept
<code>C:\code\source.scss</code> - note the direction of the slash. The <code>sass</code> team is aware of this issue, and apparently
<a href="https://github.com/nex3/sass/commit/de40a35201b982524b2d04e52541b43e61a43097">has been
fixed</a>
just a couple of days ago. The fix isn't in 3.3.0.rc.2, however, and by looking
at the affected files, monkey-patching could have unintended consequences.</p>
<p>So, if you're using <code>scss</code> from the command line, just give paths in the format which
Pathname can digest: <code>scss --sourcemaps C:/code/scss/style.scss C:/code/css/style.css</code>.</p>
<h4>Vim Setup</h4>
<p>Here I'll describe what I did to run <code>scss</code> automatically, so that everytime
<code>scss</code> file is saved, it is converted to <abbr title="Cascading Style Sheets">CSS</abbr>. To make this possible, we'll save
the OS path separator in a variable, and make a little function with will
convert paths to the <code>Pathname</code> format:</p>
<pre><code>" determine path separator
if has('win16') || has('win32') || has ('win95') || has('win64')
    let s:sep = '\'
else 
    let s:sep = '/'
endif

" converts a Windows path to Pathname format
function! PathToPathname(path)
    if has('win16') || has('win32') || has ('win95') || has('win64')
        return substitute( a:path, '\\','/','g')
    else
        return a:path
    endif
endfunction
</code></pre>
<p>We'll use this stuff in an <code>BufWritePost</code> autocommand:</p>
<pre><code>au BufWritePost *.scss :execute('!scss --sourcemap '.PathToPathname(expand('%:p')).' '.PathToPathname(expand('%:p:r').'.css'))
</code></pre>
<p>It's ugly, but it works.</p>
<p><em>to be continued...</em></p>
    </body>
</html>
