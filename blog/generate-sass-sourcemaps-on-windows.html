<p>Posted: 4th of February 2014</p>

<p>You might be aware of the awesomeness that is possible with upcoming Sass 3.3
and Chrome DevTools. It allows you to treat SCSS as CSS - with inline editing,
and all that. Check <a href="https://www.youtube.com/watch?v=x6qe_kVaBpg">this</a> out, if
you're not.</p>

<h4 id="whywouldineedsourcemaps">Why would I need sourcemaps ?</h4>

<p>The biggest problem with SCSS and other pre-processors is that you write in one
language (SCSS), but in you DevTools/Firebug, you get CSS. This indirection can
make it difficult to "map" the generated CSS to the SCSS you've written.</p>

<p>For example, you can see that a button is red. You fire up DevTools to see
where that color is set. You quickly spot the CSS rule, but then you realize
that the CSS you're looking at was actually generated by SASS from your SCSS
file! And you have to manually look through the SCSS code, trying to find which
SCSS rule generated the CSS rule.</p>

<p>In simple cases, this "mapping" might not be an issue. However, in projects of
any significance, this can be frustrating.</p>

<p>This is the problem sourcemaps are meant to solve. Basically, you tell SASS
that when it generates CSS files from your SCSS code, it should also create a
file that explicitly states which SCSS code generated each CSS statement.</p>

<p>So, if you have style.scss, after running SASS you get the usual style.css, and
style.map. This .map file is not meant for human consumption, but Chrome
DevTools knows how to read it, and enables it to tell exactly where each CSS
statement comes from. Effectively, it maps the contents of the generated CSS
file back to the "source" SCSS code. Hence, sourcemap!</p>

<h4 id="gettingsasstoworkonwindows">Getting SASS to work on Windows</h4>

<p>Setup for unixy platforms is easy, described
<a href="https://medium.com/what-i-learned-building/b4daab987fb0">here</a> among other
places. But I ran into a few issues on Windows.</p>

<p>First of all, since this functionality is not yet included in stable SASS gems,
you need to get a <code>--pre</code> version of the gem. But it didn't work for me:</p>

<pre><code>$ gem install sass --pre --no-ri --no-rdoc
ERROR:  While executing gem ... (Gem::DependencyError)
  Unable to resolve dependencies: sass requires listen (~&gt; 1.1.0)
</code></pre>

<p>After some research I did find something that worked:</p>

<pre><code>$ gem install sass -v 3.3.0.rc.2
</code></pre>

<p>Great ! To make sure:</p>

<pre><code>$ scss --version
Sass 3.3.0.rc.2 (Maptastic Maple)
</code></pre>

<p>But then I ran into another problem:</p>

<pre><code>C:\Windows\system32\cmd.exe /c (scss --sourcemap --trace C:\code\scss\style.scss C:\code\css\style.css)
C:/Ruby200-x64/lib/ruby/2.0.0/pathname.rb:500:in `relative_path_from': different
 prefix: "C:/" and "C:\\code/tc/mockup/css" (ArgumentError)
        from C:/Ruby200-x64/lib/ruby/gems/2.0.0/gems/sass-3.3.0.rc.2/lib/sass/source/map.rb:128:in `block in to_json'
        from C:/Ruby200-x64/lib/ruby/gems/2.0.0/gems/sass-3.3.0.rc.2/lib/sass/source/map.rb:123:in `each'
        from C:/Ruby200-x64/lib/ruby/gems/2.0.0/gems/sass-3.3.0.rc.2/lib/sass/source/map.rb:123:in `to_json'
        from C:/Ruby200-x64/lib/ruby/gems/2.0.0/gems/sass-3.3.0.rc.2/lib/sass/exec.rb:378:in `process_result'
        from C:/Ruby200-x64/lib/ruby/gems/2.0.0/gems/sass-3.3.0.rc.2/lib/sass/exec.rb:43:in `parse'
        from C:/Ruby200-x64/lib/ruby/gems/2.0.0/gems/sass-3.3.0.rc.2/lib/sass/exec.rb:22:in `parse!'
        from C:/Ruby200-x64/lib/ruby/gems/2.0.0/gems/sass-3.3.0.rc.2/bin/scss:9:in `&lt;top (required)&gt;'
        from C:/Ruby200-x64/bin/scss:23:in `load'
        from C:/Ruby200-x64/bin/scss:23:in `&lt;main&gt;'
shell returned 1
Hit any key to close this window...
</code></pre>

<p>This problem is described in a couple of places, the best description I could
find being <a href="https://github.com/oneclick/rubyinstaller/issues/179">on this RubyInstaller
    issue</a>. The issue is that
Ruby's Pathname wants files as <code>C:/code/source.scss</code>; it cannot accept
<code>C:\code\source.scss</code>. The SASS team is aware of this issue, and apparently
<a href="https://github.com/nex3/sass/commit/de40a35201b982524b2d04e52541b43e61a43097">has been
    fixed</a>
just a couple of days ago. The fix isn't in 3.3.0.rc.2, however, and by looking
at the affected files, monkey-patching could have unintended consequences.</p>

<h4 id="vimsetup">Vim Setup</h4>

<p>Since I'm using Vim, I made a little function which will convert standard Windows
paths to the format accepted by Pathname:</p>

<pre><code>function! PathToPathname(path)
    return substitute( a:path, '\\','/','g')
endfunction
</code></pre>

<p>Also, to convert scss files as soon as they are saved:</p>

<pre><code>au BufWritePost *.scss :execute('!scss --sourcemap '.PathToPathname(expand('%:p')).' '.PathToPathname(TrimDirs(expand('%:p'),2).'css'.s:sep.expand('%:t:r').'.css'))
</code></pre>

<p>It's ugly, but it works.</p>

<p><em>to be continued...</em></p>
